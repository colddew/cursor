# 过滤词危险性分析报告

## 当前过滤词列表

### 1. INSTRUCTION_FEATURES（正则模式）
```python
[
    r"前\s*\d+\s*位数字为.*代码",      # 匹配："前4位数字为院校代码"
    r"含\s*\d+\s*位专业组代码",        # 匹配："含3位专业组代码"
    r"括号内为专业收费标准",          # 匹配："括号内为专业收费标准"
    r"专业名称后数字为.*人数",        # 匹配："专业名称后数字为招生人数"
    r"院校名称后为专业组"             # 匹配："院校名称后为专业组"
]
```

**危险性：✅ 低**
- 这些都是结构描述性语句，不太可能出现在真实数据中
- 已验证：Page 01-06 没有误杀

### 2. instruction_keywords（关键词列表）
```python
[
    "考生本人务必",        # ⚠️ 危险：可能出现在备注中
    "填报志愿",            # ❌ 高危：已经误杀了 Page 04 的专业行
    "志愿信息",            # ⚠️ 危险：可能出现在备注中
    "录入错误",            # ✅ 安全：不太可能出现在数据中
    "招生计划不分",        # ✅ 安全：只在说明文字中
    "科目组合",            # ⚠️ 危险：可能出现在专业要求中
    "综合分计算公式",      # ✅ 安全：只在说明文字中
    "综合分=",             # ✅ 安全：只在公式中
    "平行志愿",            # ⚠️ 危险：可能出现在备注中
    "院校专业组志愿",      # ⚠️ 危险：可能出现在备注中
    "专业服从志愿",        # ⚠️ 危险：可能出现在备注中
    "$$"                   # ✅ 安全：只在数学公式中
]
```

**危险性分析：**

#### ❌ 高危词（已造成误杀）：
1. **"填报志愿"** - 已经误杀了 Page 04 的专业行
   - 原因：专业备注中包含"详见本书第一部分《填报志愿注意事项》"
   - 解决方案：✅ 已修复（优先判断是否是数据行）

#### ⚠️ 中危词（可能误杀）：
2. **"考生本人务必"** - 可能出现在某些专业的特殊要求中
3. **"志愿信息"** - 可能出现在备注中
4. **"科目组合"** - 可能出现在选科要求中（如"历史科目组合"）
5. **"平行志愿"** - 可能出现在录取规则说明中
6. **"院校专业组志愿"** - 可能出现在填报说明中
7. **"专业服从志愿"** - 可能出现在录取规则中

#### ✅ 安全词：
8. **"录入错误"** - 只在说明文字中
9. **"招生计划不分"** - 只在说明文字中
10. **"综合分计算公式"** - 只在说明文字中
11. **"综合分="** - 只在公式中
12. **"$$"** - 只在数学公式中

### 3. 超长段落检查
```python
if len(line) > 100:
    return True
```

**危险性：⚠️ 中危**
- 某些专业的备注信息可能超过100字符
- 例如：Page 04 的专业行长度为71字符（刚好在阈值内）
- 建议：提高阈值到150字符，或者结合其他条件判断

## 当前保护机制

### ✅ 已实现的保护：
```python
# 优先判断：如果是数据行（以数字代码开头且包含人数），则不是说明文字
if re.match(r'^\d{2,4}\s+', line) and re.search(r'\d+\s*人', line):
    return False
```

**效果：**
- 即使一行包含"填报志愿"等关键词，只要它是数据行（有代码+人数），就不会被过滤
- 这个机制已经成功保护了 Page 04 的专业行

## 建议优化

### 1. 移除高危词
建议移除或修改以下关键词：
- ~~"填报志愿"~~ - 太宽泛，容易误杀（已通过优先判断保护）
- ~~"志愿信息"~~ - 太宽泛
- ~~"平行志愿"~~ - 可能出现在数据中

### 2. 更精确的匹配
将宽泛的关键词改为更精确的短语：
```python
instruction_keywords = [
    "考生本人务必完全了解",      # 更精确
    "志愿信息应由考生本人录入",  # 更精确
    "招生计划不分历史科目组合",  # 更精确
    "综合分计算公式",
    "综合分=",
    "$$"
]
```

### 3. 提高超长段落阈值
```python
# 从100提高到150
if len(line) > 150:
    return True
```

### 4. 组合条件判断
```python
# 超长段落 + 不包含代码 + 包含关键词
if len(line) > 100 and not re.match(r'^\d{2,4}\s+', line) and any(kw in line for kw in keywords):
    return True
```

## 测试结果

### Page 01-06 测试：
- ✅ Page 01: 无误杀
- ✅ Page 02: 无误杀
- ✅ Page 03: 无误杀
- ✅ Page 04: **已修复**（之前被"填报志愿"误杀，现已恢复）
- ✅ Page 05: 说明文字正确过滤
- ✅ Page 06: 跨页数据正确保留

## 结论

当前的过滤机制在增加了"优先判断数据行"的保护后，已经能够正确处理所有测试页面。

**关键保护机制：**
```python
# 如果是数据行（有代码+人数），则不过滤
if re.match(r'^\d{2,4}\s+', line) and re.search(r'\d+\s*人', line):
    return False
```

这个机制确保了即使数据行包含"危险词"（如"填报志愿"），也不会被误杀。
