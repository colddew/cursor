# æ‰¹é‡å¤„ç†ä½¿ç”¨æŒ‡å—

## ğŸ“‹ ç›®å½•ç»“æ„å»ºè®®

### æ¨èçš„æ–‡ä»¶ç»„ç»‡æ–¹å¼

```
pdf2excel/
â”œâ”€â”€ scripts/                    # è„šæœ¬ç›®å½•
â”œâ”€â”€ data/                      # åŸå§‹æ•°æ®ï¼ˆæŒ‰çœä»½ç»„ç»‡ï¼‰
â”‚   â”œâ”€â”€ zhejiang/             # æµ™æ±Ÿçœ
â”‚   â”‚   â”œâ”€â”€ images/           # åŸå§‹å›¾ç‰‡ï¼ˆpage_001.png ~ page_381.pngï¼‰
â”‚   â”‚   â”œâ”€â”€ output/           # è¾“å‡ºç›®å½•
â”‚   â”‚   â”‚   â”œâ”€â”€ page_001_20260121_223000.md
â”‚   â”‚   â”‚   â”œâ”€â”€ page_001_20260121_223000.xlsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ...
â”‚   â”‚   â”‚   â”œâ”€â”€ failed_files.txt         # å¤±è´¥æ–‡ä»¶åˆ—è¡¨ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ batch_report_*.txt       # å¤„ç†æŠ¥å‘Šï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â”‚   â””â”€â”€ README.md         # è¯¥çœä»½çš„è¯´æ˜
â”‚   â”‚
â”‚   â”œâ”€â”€ anhui_history/        # å®‰å¾½çœå†å²ç»„
â”‚   â”‚   â”œâ”€â”€ images/           # page_001.png ~ page_367.png
â”‚   â”‚   â””â”€â”€ output/
â”‚   â”‚
â”‚   â””â”€â”€ anhui_physics/        # å®‰å¾½çœç‰©ç†ç»„
â”‚       â”œâ”€â”€ images/           # page_001.png ~ page_214.png
â”‚       â””â”€â”€ output/
â”‚
â””â”€â”€ .env                       # é…ç½®æ–‡ä»¶
```

---

## ğŸš€ å®Œæ•´å¤„ç†æµç¨‹

### æµ™æ±Ÿçœå¤„ç†æµç¨‹ï¼ˆ381é¡µï¼‰

#### 1. å‡†å¤‡å›¾ç‰‡
```bash
# ç¡®ä¿å›¾ç‰‡åœ¨æ­£ç¡®çš„ç›®å½•
ls data/zhejiang/images/page_*.png | wc -l
# è¾“å‡ºåº”è¯¥æ˜¯ 381
```

#### 2. é¦–æ¬¡å¤„ç†ï¼ˆå…¨é‡ï¼‰
```bash
cd scripts
python process_images_parallel.py ../data/zhejiang/images --output-dir ../data/zhejiang/output
```

**é¢„è®¡è€—æ—¶**: çº¦ 1 å°æ—¶ï¼ˆå¹¶å‘5ï¼‰

#### 3. æ£€æŸ¥ç»“æœ
```bash
# æŸ¥çœ‹æˆåŠŸæ•°é‡
ls ../data/zhejiang/output/*.xlsx | wc -l

# å¦‚æœæœ‰å¤±è´¥ï¼ŒæŸ¥çœ‹å¤±è´¥åˆ—è¡¨
cat ../data/zhejiang/output/failed_files.txt
```

#### 4. é‡è¯•å¤±è´¥æ–‡ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰
```bash
python process_images_parallel.py ../data/zhejiang/images --retry-failed
```

#### 5. éªŒè¯å®Œæ•´æ€§
```bash
# åº”è¯¥æœ‰ 381 ä¸ª Excel æ–‡ä»¶
ls ../data/zhejiang/output/*.xlsx | wc -l
```

---

### å®‰å¾½çœå¤„ç†æµç¨‹ï¼ˆåˆ†ä¸¤æ‰¹ï¼‰

#### æ‰¹æ¬¡1ï¼šå†å²ç»„ï¼ˆ367é¡µï¼‰

```bash
# é¦–æ¬¡å¤„ç†
python process_images_parallel.py ../data/anhui_history/images \
    --output-dir ../data/anhui_history/output

# å¦‚æœ‰å¤±è´¥ï¼Œé‡è¯•
python process_images_parallel.py ../data/anhui_history/images --retry-failed
```

**é¢„è®¡è€—æ—¶**: çº¦ 56 åˆ†é’Ÿ

#### æ‰¹æ¬¡2ï¼šç‰©ç†ç»„ï¼ˆ214é¡µï¼‰

```bash
# é¦–æ¬¡å¤„ç†
python process_images_parallel.py ../data/anhui_physics/images \
    --output-dir ../data/anhui_physics/output

# å¦‚æœ‰å¤±è´¥ï¼Œé‡è¯•
python process_images_parallel.py ../data/anhui_physics/images --retry-failed
```

**é¢„è®¡è€—æ—¶**: çº¦ 33 åˆ†é’Ÿ

---

## ğŸ“ å¸¸è§ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæ­£å¸¸å¤„ç†ï¼ˆä¸€æ¬¡æˆåŠŸï¼‰

```bash
python process_images_parallel.py ../data/zhejiang/images

# è¾“å‡ºç¤ºä¾‹ï¼š
# âœ… æˆåŠŸ: 381/381
# âŒ å¤±è´¥: 0/381
# â±ï¸  æ€»è€—æ—¶: 3520.5ç§’ (58.7åˆ†é’Ÿ)
```

### åœºæ™¯2ï¼šä¸­é€”è¢«ä¸­æ–­ï¼ˆCtrl+Cï¼‰

```bash
# ç¬¬ä¸€æ¬¡è¿è¡Œï¼Œå¤„ç†äº† 200é¡µåè¢«ä¸­æ–­
python process_images_parallel.py ../data/zhejiang/images
^C  # æŒ‰ Ctrl+C ä¸­æ–­

# ç»­ä¼ ï¼šè‡ªåŠ¨è·³è¿‡å·²å¤„ç†çš„ 200é¡µ
python process_images_parallel.py ../data/zhejiang/images --skip-existing

# è¾“å‡ºç¤ºä¾‹ï¼š
# âœ… å·²å¤„ç†ï¼ˆè·³è¿‡ï¼‰: 200
# ğŸ“ å¾…å¤„ç†: 181
```

### åœºæ™¯3ï¼šéƒ¨åˆ†å¤±è´¥éœ€è¦é‡è¯•

```bash
# ç¬¬ä¸€æ¬¡è¿è¡Œ
python process_images_parallel.py ../data/zhejiang/images

# è¾“å‡ºç¤ºä¾‹ï¼š
# âœ… æˆåŠŸ: 375/381
# âŒ å¤±è´¥: 6/381
# âŒ å¤±è´¥æ–‡ä»¶åˆ—è¡¨å·²ä¿å­˜: ../data/zhejiang/output/failed_files.txt

# ä»…é‡è¯•å¤±è´¥çš„ 6ä¸ªæ–‡ä»¶
python process_images_parallel.py ../data/zhejiang/images --retry-failed

# è¾“å‡ºç¤ºä¾‹ï¼š
# ğŸ”„ é‡è¯•æ¨¡å¼ï¼šä» failed_files.txt è¯»å–åˆ° 6 ä¸ªå¤±è´¥æ–‡ä»¶
# âœ… æˆåŠŸ: 6/6
# ğŸ‰ å…¨éƒ¨æˆåŠŸï¼å·²åˆ é™¤å¤±è´¥åˆ—è¡¨æ–‡ä»¶
```

### åœºæ™¯4ï¼šå¼ºåˆ¶é‡æ–°å¤„ç†æŸä¸ªæ–‡ä»¶

```bash
# åˆ é™¤è¯¥æ–‡ä»¶çš„ Excel è¾“å‡º
rm ../data/zhejiang/output/page_123_*.xlsx

# é‡æ–°å¤„ç†ï¼ˆä¼šè‡ªåŠ¨æ£€æµ‹åˆ°ç¼ºå¤±ï¼‰
python process_images_parallel.py ../data/zhejiang/images --skip-existing
```

---

## ğŸ” è¿›åº¦æŸ¥è¯¢

### å®æ—¶æŸ¥çœ‹å¤„ç†è¿›åº¦

```bash
# æ–¹æ³•1ï¼šæŸ¥çœ‹ Excel æ–‡ä»¶æ•°é‡
ls ../data/zhejiang/output/*.xlsx | wc -l

# æ–¹æ³•2ï¼šæŸ¥çœ‹å¤±è´¥åˆ—è¡¨
cat ../data/zhejiang/output/failed_files.txt

# æ–¹æ³•3ï¼šæŸ¥çœ‹æœ€æ–°çš„å¤„ç†æŠ¥å‘Š
ls -t ../data/zhejiang/output/batch_report_*.txt | head -1 | xargs cat
```

### Python è„šæœ¬æŸ¥è¯¢
```python
from pathlib import Path

# ç»Ÿè®¡å¤„ç†è¿›åº¦
images = list(Path('data/zhejiang/images').glob('page_*.png'))
excels = list(Path('data/zhejiang/output').glob('page_*.xlsx'))

print(f"æ€»å›¾ç‰‡: {len(images)}")
print(f"å·²å¤„ç†: {len(excels)}")
print(f"å¾…å¤„ç†: {len(images) - len(excels)}")
print(f"å®Œæˆç‡: {len(excels)/len(images)*100:.1f}%")
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### .env é…ç½®æ–‡ä»¶

```bash
# å¹¶å‘å¤„ç†é…ç½®
MAX_WORKERS=5              # å¹¶å‘æ•°ï¼ˆæ¨è5ï¼Œä¸è¦è¶…è¿‡8ï¼‰
API_REQUEST_DELAY_MS=500   # è¯·æ±‚é—´éš”ï¼ˆæ¯«ç§’ï¼Œé˜²æ­¢é™æµï¼‰

# Excel è¾“å‡ºé…ç½®
MAX_TEXT_LABEL_LENGTH=30   # çŸ­æ–‡æœ¬é˜ˆå€¼
EXCEL_TABLE_GAP_ROWS=3     # è¡¨æ ¼é—´éš”è¡Œæ•°
EXCEL_MAX_COLUMN_WIDTH=50  # åˆ—å®½ä¸Šé™

# API é…ç½®
AISTUDIO_API_URL=ä½ çš„APIåœ°å€
AISTUDIO_TOKEN=ä½ çš„è®¿é—®ä»¤ç‰Œ
```

### è°ƒæ•´å¹¶å‘æ•°

æ ¹æ®ç½‘ç»œæƒ…å†µè°ƒæ•´ï¼š
- **ç½‘ç»œå¥½**: `MAX_WORKERS=8`, `API_REQUEST_DELAY_MS=300`
- **ç½‘ç»œä¸€èˆ¬**: `MAX_WORKERS=5`, `API_REQUEST_DELAY_MS=500` (æ¨è)
- **ç½‘ç»œå·®æˆ–é¢‘ç¹é™æµ**: `MAX_WORKERS=3`, `API_REQUEST_DELAY_MS=1000`

---

## âŒ æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šå¤§é‡æ–‡ä»¶å¤±è´¥

**å¯èƒ½åŸå› **: API é™æµã€ç½‘ç»œé—®é¢˜

**è§£å†³æ–¹æ³•**:
```bash
# é™ä½å¹¶å‘æ•°å’Œå¢åŠ å»¶è¿Ÿ
# åœ¨ .env ä¸­è®¾ç½®ï¼š
MAX_WORKERS=3
API_REQUEST_DELAY_MS=1000

# é‡è¯•å¤±è´¥æ–‡ä»¶
python process_images_parallel.py ../data/zhejiang/images --retry-failed
```

### é—®é¢˜2ï¼šfailed_files.txt ä¸å­˜åœ¨

**è¯´æ˜**: å…¨éƒ¨æˆåŠŸï¼Œè„šæœ¬ä¼šè‡ªåŠ¨åˆ é™¤è¯¥æ–‡ä»¶

**æŸ¥çœ‹æ–¹æ³•**:
```bash
# æŸ¥çœ‹æœ€æ–°çš„å¤„ç†æŠ¥å‘Š
cat ../data/zhejiang/output/batch_report_*.txt
```

### é—®é¢˜3ï¼šè¾“å‡ºç›®å½•æ··ä¹±

**å»ºè®®**: ä¸ºæ¯ä¸ªçœä»½/æ‰¹æ¬¡ä½¿ç”¨ç‹¬ç«‹çš„è¾“å‡ºç›®å½•

```bash
# âœ… æ­£ç¡®ï¼šæŒ‡å®šè¾“å‡ºç›®å½•
python process_images_parallel.py \
    ../data/zhejiang/images \
    --output-dir ../data/zhejiang/output

# âŒ é”™è¯¯ï¼šä½¿ç”¨é»˜è®¤è¾“å‡ºï¼ˆå’Œå›¾ç‰‡åœ¨åŒä¸€ç›®å½•ï¼‰
python process_images_parallel.py ../data/zhejiang/images
```

---

## ğŸ“Š æ€§èƒ½é¢„ä¼°

åŸºäºå®æµ‹æ•°æ®ï¼ˆå¹¶å‘5ï¼Œè¯·æ±‚é—´éš”500msï¼‰ï¼š

| çœä»½/æ‰¹æ¬¡  | é¡µæ•°      | é¢„ä¼°æ—¶é—´    | å®é™…èŒƒå›´        |
| ---------- | --------- | ----------- | --------------- |
| æµ™æ±Ÿ       | 381é¡µ     | 1.0å°æ—¶     | 0.9-1.2å°æ—¶     |
| å®‰å¾½å†å²ç»„ | 367é¡µ     | 56åˆ†é’Ÿ      | 50-70åˆ†é’Ÿ       |
| å®‰å¾½ç‰©ç†ç»„ | 214é¡µ     | 33åˆ†é’Ÿ      | 30-40åˆ†é’Ÿ       |
| **æ€»è®¡**   | **962é¡µ** | **2.6å°æ—¶** | **2.3-3.1å°æ—¶** |

æ³¨æ„ï¼šå®é™…æ—¶é—´å— API å“åº”é€Ÿåº¦å½±å“ï¼Œå¯èƒ½æœ‰ Â±20% çš„æ³¢åŠ¨ã€‚

---

## ğŸ“š å‘½ä»¤å‚æ•°è¯´æ˜

```bash
python process_images_parallel.py [å›¾ç‰‡ç›®å½•] [é€‰é¡¹]
```

### å¿…éœ€å‚æ•°
- `image_dir`: å›¾ç‰‡ç›®å½•è·¯å¾„

### å¯é€‰å‚æ•°
- `--skip-existing`: è·³è¿‡å·²å¤„ç†çš„æ–‡ä»¶
- `--retry-failed`: ä»…é‡è¯•å¤±è´¥çš„æ–‡ä»¶
- `--output-dir`: æŒ‡å®šè¾“å‡ºç›®å½•ï¼ˆé»˜è®¤ä¸ºå›¾ç‰‡ç›®å½•çš„çˆ¶ç›®å½•ï¼‰
- `--script`: OCR è„šæœ¬åç§°ï¼ˆé»˜è®¤: aistudio_paddleocr_vl.pyï¼‰

### ä½¿ç”¨ç¤ºä¾‹
```bash
# æŸ¥çœ‹å¸®åŠ©
python process_images_parallel.py --help

# å®Œæ•´ç¤ºä¾‹
python process_images_parallel.py \
    ../data/zhejiang/images \
    --output-dir ../data/zhejiang/output \
    --skip-existing
```

---

## ğŸ¯ æœ€ä½³å®è·µ

1. **åˆ†æ‰¹å¤„ç†**: æµ™æ±Ÿã€å®‰å¾½å†å²ã€å®‰å¾½ç‰©ç†åˆ†å¼€å¤„ç†
2. **ä½¿ç”¨ç‹¬ç«‹è¾“å‡ºç›®å½•**: æ¯ä¸ªæ‰¹æ¬¡ä¸€ä¸ªè¾“å‡ºç›®å½•
3. **å®šæœŸæ£€æŸ¥**: æ¯å¤„ç†100é¡µæ£€æŸ¥ä¸€æ¬¡è¿›åº¦
4. **ä¿ç•™æ—¥å¿—**: å¤„ç†æŠ¥å‘Šå’Œå¤±è´¥åˆ—è¡¨ä¸è¦åˆ é™¤
5. **æ™šä¸Šè¿è¡Œ**: å¤§æ‰¹é‡å¤„ç†å»ºè®®æ™šä¸Šæˆ–å‘¨æœ«è¿è¡Œ
6. **ç½‘ç»œç¨³å®š**: ç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®š

---

**æœ€åæ›´æ–°**: 2026-01-21
