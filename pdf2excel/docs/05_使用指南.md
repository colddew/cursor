# PDF/图片表格提取完整指南

## 🎯 三种方案对比

| 方案             | 速度        | 准确率    | 表格识别     | 成本     | 适用场景           |
| ---------------- | ----------- | --------- | ------------ | -------- | ------------------ |
| **Apple Vision** | ⚡⚡⚡⚡⚡ 2-3秒 | ⭐⭐⭐⭐ 85%  | ❌ 需手动重组 | 免费     | 快速文本提取       |
| **百度通用 OCR** | ⚡⚡⚡⚡ 1-2秒  | ⭐⭐⭐⭐ 90%  | ❌ 需手动重组 | 免费额度 | 一般文档           |
| **百度表格识别** | ⚡⚡⚡ 3-5秒   | ⭐⭐⭐⭐⭐ 95% | ✅ 自动识别   | 付费     | 📋 **推荐用于表格** |

---

## 📝 推荐使用流程

### ✅ 方案选择

**如果是文字和表格混排（如招生大本）**：
```bash
# 推荐：百度表格识别（自动保留表格结构）
export BAIDU_OCR_API_KEY='your_key'
export BAIDU_OCR_SECRET_KEY='your_secret'
./venv/bin/python baidu_table_ocr.py zhejiang.png
```

**如果只是普通文本识别**：
```bash
# 使用 Apple Vision（最快）
./venv/bin/python vision_ocr.py zhejiang.png
```

---

## 🔑 百度 API Key 获取步骤

### 1. 注册账号
访问：https://ai.baidu.com/
- 使用百度账号登录（手机号注册即可）

### 2. 创建应用
1. 进入【控制台】
2. 选择【文字识别】
3. 点击【创建应用】
4. 填写应用信息：
   - 应用名称：随便填（如"表格识别"）
   - 应用描述：随便填
   - 接口选择：勾选【表格文字识别】

### 3. 获取密钥
创建成功后，在应用列表中可以看到：
- **API Key**
- **Secret Key**

### 4. 设置环境变量
```bash
# 临时设置（关闭终端后失效）
export BAIDU_OCR_API_KEY='your_api_key_here'
export BAIDU_OCR_SECRET_KEY='your_secret_key_here'

# 永久设置（推荐）
echo 'export BAIDU_OCR_API_KEY="your_api_key_here"' >> ~/.zshrc
echo 'export BAIDU_OCR_SECRET_KEY="your_secret_key_here"' >> ~/.zshrc
source ~/.zshrc
```

### 5. 免费额度（2025年最新）

完成**实名认证**后自动获取：
- **个人认证**：每月 **500次** 免费
- **企业认证**：每月 **1000次** 免费

**注意**：
- ⚠️ 不是每天额度，而是**每月额度**
- ✅ 500-1000次/月对于招生大本处理完全足够
- 💰 超出后：预付费次数包（1万次 50元）或按量付费（￥0.005/次起）

---

## 🚀 使用方法

### 方法 1：百度表格识别（推荐）

```bash
# 单张图片
./venv/bin/python baidu_table_ocr.py zhejiang.png

# 输出：zhejiang.xlsx（自动保留表格结构）
```

**优势**：
- ✅ 自动识别表格结构
- ✅ 直接生成格式化的 Excel
- ✅ 文字和表格混排处理好

**劣势**：
- ❌ 需要 API Key
- ❌ 有免费额度限制（50次/天）
- ❌ 需要网络连接

---

### 方法 2：Apple Vision（快速本地）

```bash
# 图片或 PDF
./venv/bin/python vision_ocr.py zhejiang.png
./venv/bin/python vision_ocr.py zhejiang.pdf

# 输出：zhejiang.xlsx（文本按坐标排列）
```

**优势**：
- ✅ 完全本地，无需网络
- ✅ 速度极快（2-3 秒）
- ✅ 免费无限制

**劣势**：
- ❌ 表格结构需要手动整理
- ❌ 准确率略低于百度

---

### 方法 3：百度通用 OCR（备选）

```bash
# 配置 API Key（同上）
./venv/bin/python baidu_ocr.py zhejiang.png

# 输出：zhejiang.xlsx（按行重组）
```

**适用场景**：一般文档，非表格为主

---

## 📊 实测性能对比

基于 `zhejiang.png`（629KB，包含文字和表格）：

| 指标           | Vision OCR | 百度通用 | 百度表格   |
| -------------- | ---------- | -------- | ---------- |
| **处理时间**   | 2.6秒      | ~2秒     | ~4秒       |
| **识别文本块** | 27         | ~30      | N/A        |
| **表格结构**   | ❌ 丢失     | ❌ 丢失   | ✅ 完整保留 |
| **准确率**     | 85%        | 90%      | 95%        |

---

## 💡 最佳实践建议

### 针对招生大本等表格文档：

1. **首选方案**：百度表格识别 API
   - 效果最好，表格结构完整
   - 每天 50 次免费额度通常够用

2. **大批量处理**：
   - 使用 Vision OCR 快速预览
   - 重要页面用百度表格识别精确处理

3. **图片 vs PDF**：
   - **推荐使用图片**（JPG/PNG）
   - 处理更简单，速度稍快
   - 避免 PDF 转换损失

4. **图片质量建议**：
   - 分辨率：至少 300 DPI
   - 格式：PNG > JPG（无损）
   - 光线：均匀，避免阴影
   - 角度：正面拍摄，避免倾斜

---

## 🔧 故障排除

### 问题 1：百度 API 报错 "access_token invalid"
**解决**：重新获取 API Key，检查环境变量设置

### 问题 2：Vision OCR 表格结构混乱
**解决**：改用百度表格识别 API

### 问题 3：识别到的文本块很少
**解决**：
1. 提高图片分辨率
2. 确保图片清晰度足够
3. 尝试不同的 OCR 方案

### 问题 4：识别速度慢
**解决**：
- Vision OCR 最快（本地处理）
- 百度 API 受网络影响
- 检查网络连接

---

## 📁 输出文件结构

所有方案都会生成包含多个工作表的 Excel 文件：

- **OCR完整数据**：所有识别结果 + 坐标
- **第1页**、**第2页**...: 按页分组的内容
- **纯文本**：合并所有文本（按页）

百度表格识别额外会：
- 自动检测表格区域
- 保留单元格合并关系
- 保留表格边框样式
