# 阳光高考网招生章程数据产品文档

## 一、项目概述

### 1.1 项目目标
从阳光高考网（gaokao.chsi.com.cn）爬取所有高校的招生章程数据，生成Excel文件供后续分析使用。

### 1.2 数据规模
- 总学校数：2915所
- 含表格章程：800所（27.5%）
- 纯文本章程：2115所（72.5%）
- 特殊招生章程：3所（密云分校、人民武装学院、艺术体育类）

### 1.3 项目状态
✅ 已完成（2026-01-16）

---

## 二、数据需求

### 2.1 核心数据字段

| 字段 | 说明 | 验证规则 |
|------|------|----------|
| 学校名称 | 高校全称 | 不能为空 |
| 省份 | 所属省份 | 不能为空 |
| 城市 | 直辖市=省份，其他可为空 | - |
| 主管部门 | 教育部/省教育厅等 | 不能为空 |
| 办学层次 | 本科 或 高职(专科) | 必须是二者之一 |
| 院校特性 | "双一流"/民办/独立学院等 | 可为空 |
| 校徽 | 图片地址 | 不能为空 |
| 招生章程链接 | 点击"招生章程>"的链接 | 不能为空 |
| 学校详情页链接 | 点击学校名称的链接 | 不能为空 |

### 2.2 扩展字段（详情页）

| 字段 | 说明 |
|------|------|
| 招生章程详情页链接 | 具体章程页面URL |
| 招生章程详情页链接名称 | 章程标题 |
| 招生章程详情页链接（特殊） | 特殊类型章程URL（如有） |
| 招生章程详情页链接名称（特殊） | 特殊类型章程标题（如有） |
| 多链接标识 | 标识是否有多个章程 |
| 招生章程内容 | 章程全文（HTML或纯文本） |
| 招生章程是否含表格 | 是/否标识 |
| 招生章程内容（特殊） | 特殊类型章程内容（3所） |

**数据补充说明**：

阳光高考网原始数据存在两个缺口：
1. **城市字段**：大量为空（仅216所填充，占7.4%）
2. **院校特性**：仅标注了"双一流"，缺少民办高校、独立学院等标签

**补充方案**：
- **城市数据**：教育部官方名单匹配（2652所，91.0%）+ 网络搜索补充（47所，1.6%）→ 100%完整
- **院校特性**：使用阳光高考网筛选按钮（yxjbz参数）反向匹配

**院校特性爬取详情**：

| 筛选类型 | URL参数 | 页数 | 学校数 |
|---------|---------|------|--------|
| 民办高校 | yxjbz=2 | 34页 | 665所 |
| 独立学院 | yxjbz=3 | 7页 | 139所 |
| 中外合作办学 | yxjbz=4 | 1页 | 12所 |
| 内地与港澳台地区合作办学 | yxjbz=5 | 1页 | 4所 |
| **合计** | - | **43页** | **820所** |

---

## 三、产品规则

### 3.1 多链接处理规则

**分类处理**：

| 类型 | 学校数 | 特征 | 处理方式 |
|------|--------|------|----------|
| 真正特殊 | 3所 | 密云分校、人民武装学院、艺术体育类 | 单独爬取，存入"特殊"列 |
| 多链接 | 8所 | 同一学校存在2个版本的章程 | 取 infoId 大的版本 |

**核心发现**：
- 3所学校内容完全相同（可能是系统重复）
- 5所学校存在轻微差异，主要是格式修正、标点符号调整、错别字更正
- **没有发现实质性内容删除的情况**
- 新版本（infoId 较大）格式更规范、质量更好

### 3.2 数据质量标准

**数据验证清单**（每页数据必须通过以下检查）：

| 验证项 | 说明 | 异常处理 |
|--------|------|----------|
| 数据条数检查 | 前29页100条/页，第30页15条 | 发现条数不对立即停止 |
| 必填字段检查 | 学校名称、主管部门、办学层次、链接格式 | 缺失或格式错误立即停止 |
| **校徽检查（关键）** | default.jpg 占比应 <10% | 占比过高说明图片未加载，增加等待时间 |
| 数据一致性检查 | 当前页URL与页码一致、非重复数据 | 发现重复或错位立即停止 |

**完整性要求**：
- 学校名称不能为空
- 主管部门不能为空
- 办学层次必须是"本科"或"高职(专科)"
- 所有链接格式必须正确（以https://开头）

**准确性要求**：
- 校徽图片中 default.jpg 的占比应 < 10%
- 双一流学校数量应 ≈ 147所
- 内容提取需包含完整的章程正文

---

## 四、流水线设计

### 4.1 设计目标
- **定期执行**：避免集中在某个时间段，数据质量有保障
- **增量更新**：只更新有变化的学校，减少资源消耗
- **断点续传**：支持从中断位置继续执行
- **数据验证**：自动检测内容完整性

### 4.2 执行流程

```
┌─────────────────────────────────────────────────────┐
│                    定期触发                          │
│                 （每周/每月一次）                     │
└────────────────────┬────────────────────────────────┘
                     │
                     v
┌─────────────────────────────────────────────────────┐
│              1. 检测需要更新的学校                    │
│    - 对比上次更新时间                                │
│    - 检查 infoId 变化                               │
│    - 生成待更新清单                                  │
└────────────────────┬────────────────────────────────┘
                     │
                     v
┌─────────────────────────────────────────────────────┐
│              2. 批量爬取更新                         │
│    - 使用已验证的配置（headless=False）              │
│    - 延迟策略（2秒/0.5秒）                           │
│    - 实时保存进度                                    │
└────────────────────┬────────────────────────────────┘
                     │
                     v
┌─────────────────────────────────────────────────────┐
│              3. 内容验证                             │
│    - 自动检测关键字                                  │
│    - 检查章节结构                                    │
│    - 内容完整性校验                                  │
└────────────────────┬────────────────────────────────┘
                     │
                     v
┌─────────────────────────────────────────────────────┐
│              4. 合并到Excel                          │
│    - 精确匹配更新（用学校名称，不用行号）             │
│    - 保留原格式                                      │
│    - 生成更新报告                                    │
└────────────────────┬────────────────────────────────┘
                     │
                     v
┌─────────────────────────────────────────────────────┐
│              5. 通知结果                             │
│    - 成功数量                                        │
│    - 失败清单                                        │
│    - 数据变化统计                                    │
└─────────────────────────────────────────────────────┘
```

### 4.3 测试验证流程

**分阶段验证，确保100%成功率**：

```
单学校测试 → 多结构测试 → 20所小批量 → 全量爬取
```

| 阶段 | 目标 | 验证内容 | 通过标准 |
|------|------|----------|----------|
| 单学校测试 | 验证提取逻辑 | 纯文本、表格、特殊类型 | 数据完整 |
| 多结构测试 | 验证兼容性 | 不同页面结构 | 全部成功 |
| 20所小批量 | 验证稳定性 | 批次处理、进度保存 | 无失败 |
| 全量爬取 | 正式执行 | 2915所学校 | 100%成功 |

### 4.4 批次大小建议

| 批次大小 | 优点 | 缺点 | 推荐场景 |
|---------|------|------|----------|
| 10条/批 | 失败影响范围小 | 总耗时较长 | 不稳定网络环境 |
| 20条/批 | 平衡速度与稳定性 | - | **推荐默认值** |
| 50条/批 | 速度较快 | 失败后重试成本高 | 稳定网络 + 验证过的脚本 |

### 4.5 进度管理

**进度文件结构**（JSON）：
```json
{
  "start_time": "2026-01-14T10:00:00",
  "verified_count": 600,
  "current_batch": 30,
  "total_batches": 146,
  "failed_list": ["学校A", "学校B"],
  "last_update": "2026-01-14T15:30:00"
}
```

**实时保存策略**：
- ❌ 错误：内存中积累所有数据，最后一次性保存
  - 风险：中断时全部数据丢失
- ✅ 正确：每批次完成后立即更新 Excel
  - 优势：中断后只损失当前批次

---

## 五、未来优化方向

### 5.1 功能优化
1. **断点续传**：支持从中断的位置继续爬取
2. **增量更新**：检测已爬取的学校，只更新有变化的
3. **内容验证**：自动检测内容完整性（如关键字、章节结构）
4. **性能监控**：记录爬取速度、成功率、错误率等指标
5. **日志完善**：结构化日志，便于问题排查

### 5.2 数据扩展
1. **历史数据**：保留历年章程版本，支持对比分析
2. **变化追踪**：记录每次更新的变化内容
3. **质量评分**：根据完整度、格式规范度给出质量分
4. **智能分类**：自动识别章程类型和章节结构

### 5.3 用户体验
1. **Web界面**：提供可视化操作界面
2. **定时任务**：支持 cron 表达式配置
3. **消息通知**：完成后发送邮件/微信通知
4. **数据导出**：支持多种格式（Excel、CSV、JSON）

---

## 六、项目结构

```
gaokao/
├── prd.md                    # 产品需求文档（本文件）
├── tech.md                   # 技术文档
├── achievement/              # 数据文件
│   ├── 招生章程.xlsx         # 主数据文件（2915所学校）
│   └── 招生章程（详情）.xlsx  # 含章程内容详情（18列）
├── analysis/                 # 分析报告
│   ├── 双一流统计.md
│   ├── 数据差异分析报告.md
│   └── 院校特性分类统计.md
├── scripts/                  # 脚本文件
│   ├── crawl_gaokao_schools.py         # 爬取学校基础信息
│   ├── crawl_enrollment_details.py     # 增量爬取详情页链接
│   ├── crawl_regulations.py            # 爬取纯文本章程
│   ├── crawl_with_tables.py            # 爬取表格章程
│   ├── crawl_special_regulations.py    # 爬取特殊章程
│   ├── fill_features_by_tags.py        # 补充院校特性
│   ├── fill_city_data.py               # 匹配城市数据
│   ├── fill_47_cities.py               # 补充剩余城市
│   ├── add_remarks.py                  # 添加备注
│   ├── merge_regulations_to_excel.py   # 合并章程到Excel
│   ├── add_special_column.py           # 添加特殊章程列
│   └── verify-with-playwright.py       # 批量验证链接
├── modules/                  # 爬虫模块
│   ├── __init__.py
│   ├── crawler.py            # 浏览器自动化核心
│   ├── extractor.py          # 内容提取逻辑
│   ├── cleaner.py            # 表格清理和格式化
│   ├── storage.py            # 文件存储管理
│   └── progress.py           # 进度跟踪和断点续传
├── details/                  # 纯文本招生章程（2115所）
│   ├── 北京大学.md
│   ├── 清华大学.md
│   └── ...
├── tables/                   # 表格招生章程（800所）
│   ├── 三亚学院.md
│   ├── 浙江东方职业技术学院.md
│   ├── 有表格的学校清单.json
│   └── ...
└── special/                  # 特殊招生章程（3所）
    ├── 首都经济贸易大学-首都经济贸易大学密云分校2025年招生章程.md
    ├── 浙江工商大学-浙江工商大学人民武装学院2025年普通高校招生章程.md
    └── 西南林业大学-西南林业大学2025年艺术、体育类招生简章.md
```

---

## 七、数据统计

### 7.1 章程类型分布

| 类型 | 数量 | 占比 | 存储位置 |
|------|------|------|----------|
| 含表格章程 | 800所 | 27.5% | tables/ |
| 纯文本章程 | 2115所 | 72.5% | details/ |
| 特殊章程 | 3所 | 0.1% | special/ |
| 无内容 | 88所 | 3.0% | - |

### 7.2 省份分布（含表格800所）

TOP 10 省份：
1. 河南 - 173所（21.6%）
2. 湖南 - 134所（16.8%）
3. 浙江 - 106所（13.2%）
4. 辽宁 - 94所（11.8%）
5. 上海 - 56所（7.0%）
6. 江西 - 40所（5.0%）
7. 山西 - 37所（4.6%）
8. 安徽 - 25所（3.1%）
9. 广西 - 21所（2.6%）
10. 福建 - 16所（2.0%）

涉及28个省级行政区

### 7.3 院校特性分布

| 特性 | 数量 | 占比 |
|------|------|------|
| 双一流 | 147所 | 5.0% |
| 民办 | 650所 | 22.3% |
| 独立学院 | 150所 | 5.1% |
| 高职专科 | 1400所 | 48.0% |

---

*最后更新：2026-01-16*
