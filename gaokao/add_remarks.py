#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
添加备注列并填写匹配失败原因
"""

import pandas as pd


def add_remarks_column():
    """添加备注列并填写失败原因"""

    print("=" * 60)
    print("添加备注列脚本")
    print("=" * 60)
    print()

    # 1. 读取数据
    print("📂 正在读取数据...")
    df = pd.read_excel('招生章程.xlsx')
    print(f"   ✅ 读取 {len(df)} 所学校")
    print()

    # 2. 添加备注列（如果不存在）
    if '备注' not in df.columns:
        df['备注'] = ''
        print("✅ 已添加备注列")
    else:
        print("ℹ️  备注列已存在")
    print()

    # 3. 定义47所失败学校的原因
    failed_reasons = {
        # 军事院校（19所）
        '国防科技大学': '军事院校，教育部名单不包含',
        '陆军工程大学': '军事院校，教育部名单不包含',
        '海军工程大学': '军事院校，教育部名单不包含',
        '空军工程大学': '军事院校，教育部名单不包含',
        '火箭军工程大学': '军事院校，教育部名单不包含',
        '网络空间部队信息工程大学': '军事院校，教育部名单不包含',
        '陆军步兵学院': '军事院校，教育部名单不包含',
        '陆军军医大学': '军事院校，教育部名单不包含',
        '空军航空大学': '军事院校，教育部名单不包含',
        '空军预警学院': '军事院校，教育部名单不包含',
        '空军军医大学': '军事院校，教育部名单不包含',
        '海军航空大学': '军事院校，教育部名单不包含',
        '海军潜艇学院': '军事院校，教育部名单不包含',
        '海军大连舰艇学院': '军事院校，教育部名单不包含',
        '武警工程大学': '军事院校，教育部名单不包含',
        '武警警官学院': '军事院校，教育部名单不包含',

        # 双一流分校/医学院（13所）
        '华北电力大学(保定)': '双一流分校，教育部以主校名义列出',
        '东北大学秦皇岛分校': '双一流分校，教育部以主校名义列出',
        '大连理工大学(盘锦校区)': '双一流分校，教育部以主校名义列出',
        '中国人民大学(苏州校区)': '双一流分校，教育部以主校名义列出',
        '浙江大学医学院': '双一流医学院，教育部以主校名义列出',
        '哈尔滨工业大学(威海)': '双一流分校，教育部以主校名义列出',
        '哈尔滨工业大学(深圳)': '双一流分校，教育部以主校名义列出',
        '北京交通大学(威海校区)': '双一流分校，教育部以主校名义列出',
        '北京师范大学(珠海校区)': '双一流分校，教育部以主校名义列出',
        '电子科技大学(沙河校区)': '双一流分校，教育部以主校名义列出',
        '中国石油大学(北京)克拉玛依校区': '双一流分校，教育部以主校名义列出',
        '西南大学(荣昌校区)': '双一流分校，教育部以主校名义列出',
        '合肥工业大学(宣城校区)': '双一流分校，教育部以主校名义列出',
        '山东大学威海分校': '双一流分校，教育部以主校名义列出',

        # 成人教育/干部学院/职工大学（12所）
        '河北青年管理干部学院': '成人教育类院校',
        '山西省政法管理干部学院': '成人教育类院校',
        '吉林省教育学院': '成人教育类院校',
        '吉林省经济管理干部学院': '成人教育类院校',
        '株洲市职工大学': '成人教育类院校',
        '广西教育学院': '成人教育类院校',
        '陕西航天职工大学': '成人教育类院校',
        '西安电力机械制造公司机电学院': '成人教育类院校',
        '陕西省建筑工程总公司职工大学': '成人教育类院校',

        # 其他特殊情况（4所）
        '北师香港浸会大学': '中外合作办学，教育部名单名称不同',
        '共青科技职业学院': '已更名为九江科技职业大学',
        '内蒙古科技大学包头师范学院': '独立办学学院',
        '内蒙古科技大学包头医学院': '独立办学学院',
        '西藏农牧学院': '已更名为西藏农牧大学',
        '重庆工业职业技术学院': '已更名为重庆工业职业技术大学',
        '新疆维吾尔医学专科学校': '已合并到新疆和田学院',
        '陕西工业职业技术学院': '已更名为陕西工业职业技术大学',
    }

    # 4. 填写备注
    print("📝 正在填写备注...")
    filled_count = 0
    for idx, row in df.iterrows():
        school_name = row['学校名称']
        if school_name in failed_reasons:
            df.at[idx, '备注'] = failed_reasons[school_name]
            filled_count += 1

    print(f"   ✅ 已填写 {filled_count} 所学校的备注")
    print()

    # 5. 调整列顺序（备注放到最后）
    columns_order = ['学校名称', '省份', '城市', '主管部门', '办学层次',
                     '院校特性', '校徽', '招生章程链接', '学校详情页链接', '备注']
    df = df[columns_order]

    # 6. 保存结果
    print("💾 正在保存...")
    df.to_excel('招生章程.xlsx', index=False, engine='openpyxl')
    print("   ✅ 已保存到 招生章程.xlsx")
    print()

    # 7. 统计备注分类
    print("=" * 60)
    print("📊 备注分类统计")
    print("=" * 60)

    remark_stats = {}
    for remark in df['备注'].dropna():
        if remark not in remark_stats:
            remark_stats[remark] = 0
        remark_stats[remark] += 1

    for remark, count in sorted(remark_stats.items(), key=lambda x: -x[1]):
        print(f"{remark}: {count} 所")

    print()
    print(f"总计: {sum(remark_stats.values())} 所学校已填写备注")
    print("=" * 60)

    return filled_count


if __name__ == '__main__':
    add_remarks_column()
