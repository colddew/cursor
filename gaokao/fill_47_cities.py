#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
补充47所匹配失败院校的城市数据
根据网络搜索和用户确认的映射关系更新城市信息
"""

import pandas as pd


def fill_47_cities():
    """补充47所院校的城市数据"""

    print("=" * 60)
    print("补充47所院校城市数据脚本")
    print("=" * 60)
    print()

    # 1. 读取数据
    print("📂 正在读取数据...")
    df = pd.read_excel('招生章程.xlsx')
    print(f"   ✅ 读取 {len(df)} 所学校")
    print()

    # 2. 定义47所院校的城市映射
    city_mapping = {
        '华北电力大学(保定)': '保定市',
        '东北大学秦皇岛分校': '秦皇岛市',
        '河北青年管理干部学院': '石家庄市',
        '山西省政法管理干部学院': '太原市',
        '内蒙古科技大学包头师范学院': '包头市',
        '内蒙古科技大学包头医学院': '包头市',
        '大连理工大学(盘锦校区)': '盘锦市',
        '海军大连舰艇学院': '大连市',
        '吉林省教育学院': '长春市',
        '吉林省经济管理干部学院': '长春市',
        '空军航空大学': '长春市',
        '中国人民大学(苏州校区)': '苏州市',
        '陆军工程大学': '南京市',
        '浙江大学医学院': '杭州市',
        '合肥工业大学(宣城校区)': '宣城市',
        '共青科技职业学院': '九江市',
        '陆军步兵学院': '南昌市',
        '北京交通大学(威海校区)': '威海市',
        '哈尔滨工业大学(威海)': '威海市',
        '山东大学威海分校': '威海市',
        '海军潜艇学院': '青岛市',
        '海军航空大学': '烟台市',
        '网络空间部队信息工程大学': '郑州市',
        '海军工程大学': '武汉市',
        '空军预警学院': '武汉市',
        '株洲市职工大学': '株洲市',
        '国防科技大学': '长沙市',
        '北师香港浸会大学': '珠海市',
        '哈尔滨工业大学(深圳)': '深圳市',
        '北京师范大学(珠海校区)': '珠海市',
        '广西教育学院': '南宁市',
        '重庆工业职业技术学院': '重庆市',
        '西南大学(荣昌校区)': '重庆市',
        '陆军军医大学': '重庆市',
        '电子科技大学(沙河校区)': '成都市',
        '武警警官学院': '成都市',
        '西藏农牧学院': '林芝市',
        '陕西工业职业技术学院': '咸阳市',
        '陕西航天职工大学': '西安市',
        '西安电力机械制造公司机电学院': '西安市',
        '陕西省建筑工程总公司职工大学': '西安市',
        '空军工程大学': '西安市',
        '空军军医大学': '西安市',
        '火箭军工程大学': '西安市',
        '武警工程大学': '西安市',
        '新疆维吾尔医学专科学校': '和田市',
        '中国石油大学(北京)克拉玛依校区': '克拉玛依市',
    }

    # 3. 更新城市数据
    print("📝 正在更新城市数据...")
    updated_count = 0
    for idx, row in df.iterrows():
        school_name = row['学校名称']
        if school_name in city_mapping:
            df.at[idx, '城市'] = city_mapping[school_name]
            updated_count += 1

    print(f"   ✅ 已更新 {updated_count} 所学校的城市信息")
    print()

    # 4. 保存结果
    print("💾 正在保存...")
    df.to_excel('招生章程.xlsx', index=False, engine='openpyxl')
    print("   ✅ 已保存到 招生章程.xlsx")
    print()

    # 5. 统计填充率
    city_filled = df['城市'].notna() & (df['城市'] != '')
    print("=" * 60)
    print("📊 更新后统计")
    print("=" * 60)
    print(f"总学校数：{len(df)} 所")
    print(f"城市字段填充：{city_filled.sum()} 所")
    print(f"城市字段填充率：{city_filled.sum()}/{len(df)} ({city_filled.sum()/len(df)*100:.1f}%)")
    print()
    print(f"✅ 本次更新：{updated_count} 所")
    print("=" * 60)

    return updated_count


if __name__ == '__main__':
    fill_47_cities()
