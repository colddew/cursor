<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>马卡龙 2048 - 纯净治愈版</title>
    <style>
        :root {
            --bg-color: #fdf6f0;
            --grid-bg: #f2e9e4;
            --text-color: #6d6875;
            --empty-cell: #fcfaf9;
            --color-2: #ffcad4;
            /* 樱花粉 */
            --color-4: #f4acb7;
            /* 蔷薇粉 */
            --color-8: #9dbebb;
            /* 薄荷绿 */
            --color-16: #468faf;
            /* 湖水蓝 */
            --color-32: #b1a7a6;
            /* 灰奶茶 */
            --color-64: #e5989b;
            /* 珊瑚橘 */
            --color-128: #b5838d;
            /* 豆沙紫 */
            --color-256: #ffb5a7;
            /* 蜜桃粉 */
            --color-512: #fcd5ce;
            /* 奶油橘 */
            --color-1024: #f8edeb;
            /* 云朵白 */
            --color-2048: #d8e2dc;
            /* 鼠尾草绿 */
        }

        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            user-select: none;
            -webkit-user-drag: none;
        }

        body {
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            color: var(--text-color);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .main-layout {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 40px;
            max-width: 900px;
            width: 95%;
            padding: 20px;
        }

        /* 左侧游戏区域 */
        .game-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 42px;
            margin: 0;
            color: var(--color-4);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.05);
        }

        .score-container {
            background-color: var(--grid-bg);
            padding: 10px 20px;
            border-radius: 12px;
            text-align: center;
        }

        .score-label {
            font-size: 12px;
            text-transform: uppercase;
            display: block;
            color: #9a8c98;
        }

        .score-value {
            font-size: 24px;
            font-weight: bold;
        }

        .game-container {
            width: 400px;
            height: 400px;
            background-color: var(--grid-bg);
            border-radius: 15px;
            padding: 15px;
            position: relative;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
            cursor: grab;
            /* 提示可以抓取拖动 */
            touch-action: none;
        }

        .game-container:active {
            cursor: grabbing;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 12px;
            width: 100%;
            height: 100%;
        }

        .cell {
            background-color: var(--empty-cell);
            border-radius: 8px;
            width: 100%;
            height: 100%;
        }

        .tiles-container {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            bottom: 15px;
            pointer-events: none;
        }

        .tile {
            position: absolute;
            width: calc((100% - 36px) / 4);
            height: calc((100% - 36px) / 4);
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px;
            font-weight: bold;
            transition: transform 120ms ease-in-out, background-color 100ms;
            z-index: 10;
        }

        /* 瓷砖颜色设置 */
        .tile-2 {
            background-color: var(--color-2);
            color: white;
        }

        .tile-4 {
            background-color: var(--color-4);
            color: white;
        }

        .tile-8 {
            background-color: var(--color-8);
            color: white;
        }

        .tile-16 {
            background-color: var(--color-16);
            color: white;
        }

        .tile-32 {
            background-color: var(--color-32);
            color: white;
        }

        .tile-64 {
            background-color: var(--color-64);
            color: white;
        }

        .tile-128 {
            background-color: var(--color-128);
            color: white;
            font-size: 28px;
        }

        .tile-256 {
            background-color: var(--color-256);
            color: white;
            font-size: 28px;
        }

        .tile-512 {
            background-color: var(--color-512);
            color: #6d6875;
            font-size: 24px;
        }

        .tile-1024 {
            background-color: var(--color-1024);
            color: #6d6875;
            font-size: 20px;
        }

        .tile-2048 {
            background-color: var(--color-2048);
            color: #6d6875;
            font-size: 20px;
        }

        .tile-new {
            animation: appear 200ms ease-out;
        }

        @keyframes appear {
            0% {
                opacity: 0;
                transform: scale(0);
            }

            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* 右侧说明区域 */
        .info-section {
            width: 320px;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .info-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--color-128);
            border-bottom: 2px solid var(--bg-color);
            padding-bottom: 10px;
        }

        .info-text {
            font-size: 15px;
            line-height: 1.8;
            color: #8d8692;
        }

        .info-text b {
            color: var(--color-16);
        }

        .restart-btn {
            background-color: var(--color-8);
            border: none;
            padding: 15px;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
            margin-top: 10px;
        }

        .restart-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .restart-btn:active {
            transform: translateY(0);
        }

        /* 游戏结束弹窗 */
        .message-box {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(253, 246, 240, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            border-radius: 15px;
            backdrop-filter: blur(4px);
        }

        /* 响应式适配 */
        @media (max-width: 850px) {
            body {
                overflow-y: auto;
                height: auto;
                padding: 20px 0;
            }

            .main-layout {
                flex-direction: column;
            }

            .game-container {
                width: 340px;
                height: 340px;
            }

            .info-section {
                width: 340px;
            }
        }
    </style>
</head>

<body>

    <div class="main-layout">
        <!-- 左侧：游戏区 -->
        <div class="game-section">
            <div class="header">
                <h1>2048</h1>
                <div class="score-container">
                    <span class="score-label">SCORE</span>
                    <span id="score" class="score-value">0</span>
                </div>
            </div>

            <div class="game-container" id="game-container">
                <div class="grid">
                    <div class="cell"></div>
                    <div class="cell"></div>
                    <div class="cell"></div>
                    <div class="cell"></div>
                    <div class="cell"></div>
                    <div class="cell"></div>
                    <div class="cell"></div>
                    <div class="cell"></div>
                    <div class="cell"></div>
                    <div class="cell"></div>
                    <div class="cell"></div>
                    <div class="cell"></div>
                    <div class="cell"></div>
                    <div class="cell"></div>
                    <div class="cell"></div>
                    <div class="cell"></div>
                </div>
                <div id="tile-layer" class="tiles-container"></div>

                <div id="game-over" class="message-box">
                    <h2 style="color: var(--color-64); font-size: 32px;">游戏结束</h2>
                    <button class="restart-btn" style="width: 150px;" onclick="resetGame()">再试一次</button>
                </div>
            </div>
        </div>

        <!-- 右侧：说明区 -->
        <div class="info-section">
            <div class="info-title">游戏指南</div>
            <div class="info-text">
                • <b>鼠标操作</b>：在棋盘区域按住左键并向任意方向拖动即可移动方块。<br>
                • <b>键盘操作</b>：使用方向键 <b>↑ ↓ ← →</b> 进行控制。<br>
                • <b>触屏操作</b>：在手机上直接滑动屏幕。<br><br>
                相同的数字方块合并时会相加。挑战一下，看看你能否调配出 <b>2048</b> 分数值的极品马卡龙！
            </div>
            <button class="restart-btn" onclick="resetGame()">重新开始游戏</button>
        </div>
    </div>

    <script>
        const gridLayer = document.getElementById('tile-layer');
        const scoreElement = document.getElementById('score');
        const gameOverBox = document.getElementById('game-over');
        const gameContainer = document.getElementById('game-container');

        let board = [];
        let score = 0;
        const size = 4;

        // 用于处理拖动/滑动逻辑
        let isDragging = false;
        let startX, startY;

        function initGame() {
            board = Array(size).fill().map(() => Array(size).fill(0));
            score = 0;
            updateScore();
            gameOverBox.style.display = 'none';
            addRandomTile();
            addRandomTile();
            renderBoard();
        }

        function addRandomTile() {
            let emptyCells = [];
            for (let r = 0; r < size; r++) {
                for (let c = 0; c < size; c++) {
                    if (board[r][c] === 0) emptyCells.push({ r, c });
                }
            }
            if (emptyCells.length > 0) {
                let cell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                board[cell.r][cell.c] = Math.random() < 0.9 ? 2 : 4;
            }
        }

        function renderBoard() {
            gridLayer.innerHTML = '';
            const gap = window.innerWidth <= 450 ? 8 : 12;
            const tileSize = (gridLayer.clientWidth - (size - 1) * gap) / size;

            for (let r = 0; r < size; r++) {
                for (let c = 0; c < size; c++) {
                    if (board[r][c] !== 0) {
                        const tile = document.createElement('div');
                        const value = board[r][c];
                        tile.classList.add('tile', `tile-${value}`, 'tile-new');
                        tile.innerText = value;
                        const x = c * (tileSize + gap);
                        const y = r * (tileSize + gap);
                        tile.style.transform = `translate(${x}px, ${y}px)`;
                        gridLayer.appendChild(tile);
                    }
                }
            }
        }

        function move(direction) {
            let moved = false;
            let tempScore = 0;

            const rotate = (matrix) => {
                const newMatrix = Array(size).fill().map(() => Array(size).fill(0));
                for (let r = 0; r < size; r++) {
                    for (let c = 0; c < size; c++) {
                        newMatrix[c][size - 1 - r] = matrix[r][c];
                    }
                }
                return newMatrix;
            };

            let rotatedBoard = JSON.parse(JSON.stringify(board));
            let rotationCount = 0;
            if (direction === 'up') rotationCount = 3;
            if (direction === 'right') rotationCount = 2;
            if (direction === 'down') rotationCount = 1;

            for (let i = 0; i < rotationCount; i++) rotatedBoard = rotate(rotatedBoard);

            for (let r = 0; r < size; r++) {
                let row = rotatedBoard[r].filter(v => v !== 0);
                for (let i = 0; i < row.length - 1; i++) {
                    if (row[i] === row[i + 1]) {
                        row[i] *= 2;
                        tempScore += row[i];
                        row.splice(i + 1, 1);
                        moved = true;
                    }
                }
                const newRow = row.concat(Array(size - row.length).fill(0));
                if (JSON.stringify(newRow) !== JSON.stringify(rotatedBoard[r])) moved = true;
                rotatedBoard[r] = newRow;
            }

            for (let i = 0; i < (4 - rotationCount) % 4; i++) rotatedBoard = rotate(rotatedBoard);

            if (moved) {
                board = rotatedBoard;
                score += tempScore;
                addRandomTile();
                updateScore();
                renderBoard();
                checkGameOver();
            }
        }

        function updateScore() {
            scoreElement.innerText = score;
        }

        function checkGameOver() {
            for (let r = 0; r < size; r++) {
                for (let c = 0; c < size; c++) if (board[r][c] === 0) return;
            }
            for (let r = 0; r < size; r++) {
                for (let c = 0; c < size; c++) {
                    if (r < size - 1 && board[r][c] === board[r + 1][c]) return;
                    if (c < size - 1 && board[r][c] === board[r][c + 1]) return;
                }
            }
            gameOverBox.style.display = 'flex';
        }

        function resetGame() { initGame(); }

        // --- 控制逻辑 (键盘 + 鼠标拖动 + 触屏滑动) ---

        // 1. 键盘监听
        window.addEventListener('keydown', (e) => {
            if (["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"].includes(e.key)) {
                e.preventDefault();
                move(e.key.replace("Arrow", "").toLowerCase());
            }
        });

        // 2. 鼠标拖动处理
        gameContainer.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
        });

        window.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            e.preventDefault();
        });

        window.addEventListener('mouseup', (e) => {
            if (!isDragging) return;
            handleGesture(e.clientX - startX, e.clientY - startY);
            isDragging = false;
        });

        // 3. 触屏滑动处理
        gameContainer.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        }, { passive: false });

        gameContainer.addEventListener('touchmove', (e) => e.preventDefault(), { passive: false });

        gameContainer.addEventListener('touchend', (e) => {
            if (!startX || !startY) return;
            handleGesture(e.changedTouches[0].clientX - startX, e.changedTouches[0].clientY - startY);
        });

        // 统一手势判定逻辑
        function handleGesture(dx, dy) {
            const threshold = 30; // 滑动最小距离判定
            if (Math.abs(dx) > Math.abs(dy)) {
                if (Math.abs(dx) > threshold) move(dx > 0 ? 'right' : 'left');
            } else {
                if (Math.abs(dy) > threshold) move(dy > 0 ? 'down' : 'up');
            }
        }

        window.onresize = renderBoard;
        initGame();
    </script>
</body>

</html>